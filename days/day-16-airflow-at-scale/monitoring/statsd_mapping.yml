# StatsD to Prometheus mapping configuration for Airflow metrics
mappings:
  # DAG metrics
  - match: "scalecorp_airflow.dag.*.*.duration"
    name: "airflow_dag_duration_seconds"
    labels:
      dag_id: "$1"
      task_id: "$2"

  - match: "scalecorp_airflow.dag_run.*.duration.*"
    name: "airflow_dag_run_duration_seconds"
    labels:
      dag_id: "$1"
      status: "$2"

  - match: "scalecorp_airflow.dag_run.*.count"
    name: "airflow_dag_run_total"
    labels:
      dag_id: "$1"

  # Task metrics
  - match: "scalecorp_airflow.task_instance.*.*.duration.*"
    name: "airflow_task_duration_seconds"
    labels:
      dag_id: "$1"
      task_id: "$2"
      status: "$3"

  - match: "scalecorp_airflow.task_instance.*.*.count"
    name: "airflow_task_instance_total"
    labels:
      dag_id: "$1"
      task_id: "$2"

  - match: "scalecorp_airflow.task_instance.*.*.*.count"
    name: "airflow_task_instance_status_total"
    labels:
      dag_id: "$1"
      task_id: "$2"
      status: "$3"

  # Scheduler metrics
  - match: "scalecorp_airflow.scheduler.heartbeat"
    name: "airflow_scheduler_heartbeat"

  - match: "scalecorp_airflow.scheduler.tasks.running"
    name: "airflow_scheduler_tasks_running"

  - match: "scalecorp_airflow.scheduler.tasks.queued"
    name: "airflow_scheduler_tasks_queued"

  - match: "scalecorp_airflow.scheduler.dag_processing.total_parse_time"
    name: "airflow_dag_processing_total_parse_time"

  - match: "scalecorp_airflow.scheduler.dag_processing.last_runtime.*"
    name: "airflow_dag_processing_last_runtime"
    labels:
      dag_file: "$1"

  # Executor metrics
  - match: "scalecorp_airflow.executor.open_slots"
    name: "airflow_executor_open_slots"

  - match: "scalecorp_airflow.executor.queued_tasks"
    name: "airflow_executor_queued_tasks"

  - match: "scalecorp_airflow.executor.running_tasks"
    name: "airflow_executor_running_tasks"

  # Celery metrics
  - match: "scalecorp_airflow.celery.queue_length.*"
    name: "airflow_celery_queue_length"
    labels:
      queue: "$1"

  - match: "scalecorp_airflow.celery.task.*.runtime"
    name: "airflow_celery_task_runtime_seconds"
    labels:
      task_name: "$1"

  # Pool metrics
  - match: "scalecorp_airflow.pool.open_slots.*"
    name: "airflow_pool_open_slots"
    labels:
      pool: "$1"

  - match: "scalecorp_airflow.pool.running_slots.*"
    name: "airflow_pool_running_slots"
    labels:
      pool: "$1"

  - match: "scalecorp_airflow.pool.total_slots.*"
    name: "airflow_pool_total_slots"
    labels:
      pool: "$1"

  # Database metrics
  - match: "scalecorp_airflow.database.*.count"
    name: "airflow_database_operations_total"
    labels:
      operation: "$1"

  - match: "scalecorp_airflow.database.*.duration"
    name: "airflow_database_operation_duration_seconds"
    labels:
      operation: "$1"

  # Custom application metrics
  - match: "scalecorp_airflow.custom.*.count"
    name: "airflow_custom_counter_total"
    labels:
      metric_name: "$1"

  - match: "scalecorp_airflow.custom.*.gauge"
    name: "airflow_custom_gauge"
    labels:
      metric_name: "$1"

  - match: "scalecorp_airflow.custom.*.timer"
    name: "airflow_custom_timer_seconds"
    labels:
      metric_name: "$1"

  # SLA metrics
  - match: "scalecorp_airflow.sla_miss.*.count"
    name: "airflow_sla_miss_total"
    labels:
      dag_id: "$1"

  # Error metrics
  - match: "scalecorp_airflow.task_fail.*.*.count"
    name: "airflow_task_fail_total"
    labels:
      dag_id: "$1"
      task_id: "$2"

  - match: "scalecorp_airflow.task_success.*.*.count"
    name: "airflow_task_success_total"
    labels:
      dag_id: "$1"
      task_id: "$2"

  # Catch-all for other Airflow metrics
  - match: "scalecorp_airflow.*"
    name: "airflow_${1}"
    labels: {}